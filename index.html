<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MBSS - Marketplace Simulation</title>
<style>
  :root {
    --primary-color: #2ecc71;
    --secondary-color: #3498db;
    --danger-color: #e74c3c;
    --success-color: #27ae60;
    --text-color: #2c3e50;
    --text-light: #7f8c8d;
    --bg-light: #ecf0f1;
    --bg-white: #ffffff;
    --border-color: #bdc3c7;
    --shadow: 0 2px 10px rgba(0,0,0,0.1);
  }
  body { font-family: 'Segoe UI', sans-serif; background: var(--bg-light); margin:0; padding:0; color: var(--text-color);}
  header { background: var(--bg-white); padding: 15px; box-shadow: var(--shadow); display:flex; justify-content:space-between; align-items:center;}
  header h1 { color: var(--primary-color);}
  nav a { margin: 0 10px; text-decoration:none; color: var(--text-color); font-weight:bold;}
  .container { max-width: 1200px; margin: 0 auto; padding:20px;}
  .btn { padding:10px 20px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; margin-top:10px;}
  .btn-primary { background: var(--primary-color); color:#000;}
  .btn-success { background: var(--success-color); color:#fff;}
  .btn-danger { background: var(--danger-color); color:#fff;}
  input, select, textarea { padding:10px; border:2px solid var(--border-color); border-radius:6px; width:100%; margin-bottom:10px;}
  .form-box { background: var(--bg-white); padding:20px; border-radius:10px; box-shadow:var(--shadow); max-width:400px; margin:auto;}
  .product-card { background: var(--bg-white); padding:15px; margin-bottom:10px; border-radius:10px; box-shadow: var(--shadow);}
  .chat-box { border:1px solid var(--border-color); padding:10px; height:200px; overflow-y:auto; background:#fff; margin-bottom:10px;}
  .chat-message { margin-bottom:5px;}
  .chat-sender { font-weight:bold; margin-right:5px;}
  .hidden { display:none;}
  h2 { color: var(--primary-color);}
</style>
</head>
<body>

<header>
  <h1>MBSS Marketplace</h1>
  <nav id="nav-links">
    <a href="#" id="homeLink">Home</a>
    <a href="#" id="loginNav">Login</a>
    <a href="#" id="registerNav">Register</a>
    <a href="#" id="dashboardNav" class="hidden">Dashboard</a>
    <a href="#" id="logoutNav" class="hidden">Logout</a>
  </nav>
</header>

<div class="container">
  <!-- Home Section -->
  <section id="homeSection">
    <h2>Welcome to MBSS Marketplace</h2>
    <p>Buy and Sell products easily. Register or Login to get started.</p>
  </section>

  <!-- Register Section -->
  <section id="registerSection" class="hidden">
    <div class="form-box">
      <h2>Register</h2>
      <form id="registerForm">
        <input type="text" name="username" placeholder="Username" required>
        <input type="email" name="email" placeholder="Email" required>
        <input type="password" name="password" placeholder="Password" required>
        <select name="role" required>
          <option value="">Select Role</option>
          <option value="buyer">Buyer</option>
          <option value="seller">Seller</option>
        </select>
        <button type="submit" class="btn btn-primary">Register</button>
      </form>
    </div>
  </section>

  <!-- Login Section -->
  <section id="loginSection" class="hidden">
    <div class="form-box">
      <h2>Login</h2>
      <form id="loginForm">
        <input type="text" name="username" placeholder="Username" required>
        <input type="password" name="password" placeholder="Password" required>
        <button type="submit" class="btn btn-success">Login</button>
      </form>
    </div>
  </section>

  <!-- Dashboard Section -->
  <section id="dashboardSection" class="hidden">
    <h2>Dashboard</h2>
    <p id="welcomeMsg"></p>

    <!-- Add Product (Seller) -->
    <div id="addProductDiv" class="hidden">
      <h3>Add Product</h3>
      <form id="addProductForm">
        <input type="text" name="productName" placeholder="Product Name" required>
        <textarea name="description" placeholder="Description" required></textarea>
        <input type="text" name="category" placeholder="Category" required>
        <input type="number" name="price" placeholder="Price" required>
        <button type="submit" class="btn btn-primary">Add Product</button>
      </form>
    </div>

    <!-- Product Search -->
    <div id="searchDiv">
      <h3>Search Products</h3>
      <input type="text" id="searchKeyword" placeholder="Keyword">
      <button id="searchBtn" class="btn btn-success">Search</button>
      <div id="productList"></div>
    </div>

    <!-- Chat Section -->
    <div id="chatDiv" class="hidden">
      <h3>Chat Simulation</h3>
      <div class="chat-box" id="chatBox"></div>
      <input type="text" id="chatMessage" placeholder="Type message">
      <button id="sendChatBtn" class="btn btn-primary">Send</button>
      <button id="agreeMeetBtn" class="btn btn-success">Agree to Meet</button>
    </div>
  </section>
</div>

<script>
/* ====== LocalStorage Helpers ====== */
function getUsers() {
  return JSON.parse(localStorage.getItem('users') || '[]');
}
function saveUsers(users) {
  localStorage.setItem('users', JSON.stringify(users));
}
function getProducts() {
  return JSON.parse(localStorage.getItem('products') || '[]');
}
function saveProducts(products) {
  localStorage.setItem('products', JSON.stringify(products));
}
function getChats() {
  return JSON.parse(localStorage.getItem('chats') || '[]');
}
function saveChats(chats) {
  localStorage.setItem('chats', JSON.stringify(chats));
}

/* ====== Navigation ====== */
const homeSection = document.getElementById('homeSection');
const registerSection = document.getElementById('registerSection');
const loginSection = document.getElementById('loginSection');
const dashboardSection = document.getElementById('dashboardSection');

const homeLink = document.getElementById('homeLink');
const loginNav = document.getElementById('loginNav');
const registerNav = document.getElementById('registerNav');
const dashboardNav = document.getElementById('dashboardNav');
const logoutNav = document.getElementById('logoutNav');

function showSection(section) {
  homeSection.classList.add('hidden');
  registerSection.classList.add('hidden');
  loginSection.classList.add('hidden');
  dashboardSection.classList.add('hidden');
  section.classList.remove('hidden');
}
homeLink.addEventListener('click',()=>showSection(homeSection));
loginNav.addEventListener('click',()=>showSection(loginSection));
registerNav.addEventListener('click',()=>showSection(registerSection));

/* ====== User Authentication ====== */
let currentUser = JSON.parse(localStorage.getItem('currentUser')||'null');

function updateNav() {
  if(currentUser){
    loginNav.classList.add('hidden');
    registerNav.classList.add('hidden');
    dashboardNav.classList.remove('hidden');
    logoutNav.classList.remove('hidden');
    document.getElementById('welcomeMsg').innerText = `Welcome, ${currentUser.username} (${currentUser.role})`;
    if(currentUser.role==='seller'){
      document.getElementById('addProductDiv').classList.remove('hidden');
    }
    showSection(dashboardSection);
    displayProducts();
  }else{
    loginNav.classList.remove('hidden');
    registerNav.classList.remove('hidden');
    dashboardNav.classList.add('hidden');
    logoutNav.classList.add('hidden');
    showSection(homeSection);
  }
}
updateNav();

/* ====== Register ====== */
document.getElementById('registerForm').addEventListener('submit', function(e){
  e.preventDefault();
  const form = e.target;
  const username = form.username.value.trim();
  const email = form.email.value.trim();
  const password = form.password.value.trim();
  const role = form.role.value;
  let users = getUsers();
  if(users.find(u=>u.username===username)){
    alert('Username exists!');
    return;
  }
  users.push({username,email,password,role});
  saveUsers(users);
  alert('Account created! Please login.');
  form.reset();
  showSection(loginSection);
});

/* ====== Login ====== */
document.getElementById('loginForm').addEventListener('submit', function(e){
  e.preventDefault();
  const form = e.target;
  const username = form.username.value.trim();
  const password = form.password.value.trim();
  const users = getUsers();
  const user = users.find(u=>u.username===username && u.password===password);
  if(user){
    currentUser = user;
    localStorage.setItem('currentUser',JSON.stringify(currentUser));
    updateNav();
  }else{
    alert('Invalid username or password');
  }
});

/* ====== Logout ====== */
logoutNav.addEventListener('click',()=>{
  currentUser=null;
  localStorage.removeItem('currentUser');
  updateNav();
});

/* ====== Add Product ====== */
document.getElementById('addProductForm')?.addEventListener('submit', function(e){
  e.preventDefault();
  const form = e.target;
  const name = form.productName.value.trim();
  const desc = form.description.value.trim();
  const cat = form.category.value.trim();
  const price = parseFloat(form.price.value);
  if(!name || !desc || !cat || price<=0){ alert('All fields required'); return; }
  const products = getProducts();
  products.push({id:Date.now(),seller:currentUser.username,productName:name,description:desc,category:cat,price});
  saveProducts(products);
  form.reset();
  displayProducts();
});

/* ====== Display Products ====== */
function displayProducts(keyword=''){
  const list = document.getElementById('productList');
  list.innerHTML='';
  const products = getProducts().filter(p=>p.productName.toLowerCase().includes(keyword.toLowerCase()) || p.description.toLowerCase().includes(keyword.toLowerCase()) || p.category.toLowerCase().includes(keyword.toLowerCase()));
  if(products.length===0) list.innerHTML='<p>No products found.</p>';
  products.forEach(p=>{
    const div = document.createElement('div');
    div.className='product-card';
    div.innerHTML=`<strong>${p.productName}</strong> - $${p.price}<br>${p.description}<br>Category: ${p.category}<br>Seller: ${p.seller}`;
    list.appendChild(div);
  });
}

/* ====== Search Products ====== */
document.getElementById('searchBtn').addEventListener('click',()=>{
  const keyword = document.getElementById('searchKeyword').value.trim();
  displayProducts(keyword);
});

/* ====== Chat Simulation ====== */
const chatDiv = document.getElementById('chatDiv');
const chatBox = document.getElementById('chatBox');
const chatMessage = document.getElementById('chatMessage');
const sendChatBtn = document.getElementById('sendChatBtn');
const agreeMeetBtn = document.getElementById('agreeMeetBtn');

function updateChat(){
  if(!currentUser) return;
  chatBox.innerHTML='';
  const chats = getChats();
  chats.forEach(c=>{
    const div = document.createElement('div');
    div.className='chat-message';
    div.innerHTML=`<span class="chat-sender">${c.sender}:</span>${c.message}`;
    chatBox.appendChild(div);
  });
  chatBox.scrollTop = chatBox.scrollHeight;
}

sendChatBtn.addEventListener('click',()=>{
  const msg = chatMessage.value.trim();
  if(!msg) return;
  const chats = getChats();
  chats.push({sender:currentUser.username,message:msg});
  saveChats(chats);
  chatMessage.value='';
  updateChat();
});

agreeMeetBtn.addEventListener('click',()=>{
  const chats = getChats();
  chats.push({sender:'System',message:`${currentUser.username} agreed to meet!`});
  saveChats(chats);
  updateChat();
});

</script>
</body>
  </html>
